# üéôÔ∏è Morgonpodd - Automatiserad Svensk Podcast Generator

En AI-driven tj√§nst som automatiskt genererar dagliga svenska podcast-avsnitt med tv√• v√§rdar, musikintegration och RSS-distribution via Cloudflare R2.

## ‚ú® Funktioner

- **ü§ñ Tv√• AI-v√§rdar**: Anna & Erik med naturlig konversation
- **üì∞ Multi-k√§lla nyheter**: Samlar inneh√•ll fr√•n svenska och internationella nyhetsk√§llor
- **üéµ Musikintegration**: Automatisk intro, outro och √∂verg√•ngsmusik
- **üó£Ô∏è Naturligt tal**: ElevenLabs text-to-dialogue API f√∂r realistiska samtal
- **üì° RSS-distribution**: Automatisk RSS-feed generering och hosting p√• Cloudflare R2
- **üå§Ô∏è V√§deruppdateringar**: Inkluderar lokal v√§derinformation
- **üéõÔ∏è Webbgr√§nssnitt**: Streamlit-baserad kontrollpanel f√∂r konfiguration

## üìã F√∂ruts√§ttningar

- Python 3.8 eller h√∂gre
- macOS, Linux eller Windows
- FFmpeg installerat (`brew install ffmpeg` p√• macOS)
- API-nycklar f√∂r OpenAI eller OpenRouter, och ElevenLabs
- Cloudflare-konto med R2 storage

## ü§ñ AI Providers

Morgonpodd st√∂djer tv√• AI-leverant√∂rer f√∂r inneh√•llsgenerering:

### OpenAI (Direkt API)
- **F√∂rdelar**: Direktintegration, stabil prestanda, senaste GPT-5 modeller
- **Modeller**: 
  - **GPT-5 serien** ‚ú®: gpt-5 (400K kontext), gpt-5-mini, gpt-5-nano
  - **GPT-4.1 serien** ‚ú®: gpt-4.1, gpt-4.1-mini, gpt-4.1-nano (1M+ kontext!)
  - **GPT-4o serien**: gpt-4o, gpt-4o-mini, gpt-4o-audio-preview
  - **o1 reasoning**: o1-pro, o1, o1-mini (avancerad resonering)
  - **GPT-4 turbo**: gpt-4-turbo, gpt-4-turbo-preview
  - **GPT-3.5**: gpt-3.5-turbo, gpt-3.5-turbo-16k
- **Kostnad**: Betala per token direkt till OpenAI
- **Skaffa nyckel**: [platform.openai.com/api-keys](https://platform.openai.com/api-keys)
- **OBS**: GPT-5 modeller √§r nu tillg√§ngliga via OpenAI API!

### OpenRouter (Rekommenderat)
- **F√∂rdelar**: Tillg√•ng till 90+ AI-modeller fr√•n olika leverant√∂rer
- **Modeller**: Claude, Gemini, Llama, GPT-4, Mistral, Command R, och m√•nga fler
- **Kostnad**: Ofta billigare √§n direkta API:er, betala endast f√∂r anv√§ndning
- **Skaffa nyckel**: [openrouter.ai](https://openrouter.ai)

#### Popul√§ra OpenRouter-modeller f√∂r svenska poddar:
- `anthropic/claude-3.5-sonnet` - Excellant f√∂r svenska samtal
- `openai/gpt-4o-mini` - Kostnadeffektiv och snabb  
- `openai/o1-mini` - Bra f√∂r komplex resonering
- `google/gemini-pro-1.5` - L√•ng kontext f√∂r inneh√•llsanalys
- `meta-llama/llama-3.1-70b-instruct` - Kraftfull open source
- `mistralai/mistral-large` - Europeisk AI med bra svenska

**Tips**: Om du har b√•de nycklar kommer systemet automatiskt att anv√§nda OpenRouter f√∂r fler modellalternativ.

## üöÄ Installation

### 1. Klona repository

```bash
git clone https://github.com/fltman/morgonradio.git
cd morgonpodd
```

### 2. S√§tt upp Python-milj√∂

```bash
# Skapa virtuell milj√∂
python3 -m venv venv

# Aktivera virtuell milj√∂
source venv/bin/activate  # P√• macOS/Linux
# eller
venv\Scripts\activate  # P√• Windows

# Installera beroenden
pip install -r requirements.txt
```

### 3. Konfigurera milj√∂variabler

Kopiera exempelfilen och redigera den:

```bash
cp .env.example .env
```

Redigera `.env` med dina API-nycklar och inst√§llningar:

```env
# OpenAI API (Kr√§vs) - eller anv√§nd OpenRouter nedan
OPENAI_API_KEY=din_openai_api_nyckel_h√§r

# OpenRouter API (Alternativ till OpenAI) - ger tillg√•ng till fler modeller
OPENROUTER_API_KEY=din_openrouter_api_nyckel_h√§r

# ElevenLabs API (Kr√§vs)
ELEVENLABS_API_KEY=din_elevenlabs_api_nyckel_h√§r
ELEVENLABS_VOICE_ID=21m00Tcm4TlvDq8ikWAM  # Rachel r√∂st, eller v√§lj annan

# Cloudflare R2 (Kr√§vs f√∂r publicering)
CLOUDFLARE_ACCOUNT_ID=ditt_konto_id_h√§r
CLOUDFLARE_ACCESS_KEY_ID=din_access_key_id_h√§r
CLOUDFLARE_SECRET_ACCESS_KEY=din_secret_access_key_h√§r
CLOUDFLARE_R2_BUCKET=morgonpodd
CLOUDFLARE_R2_PUBLIC_URL=https://morgonpodd.din-doman.com
```

## ‚òÅÔ∏è Cloudflare R2 Setup - Steg f√∂r steg

### Steg 1: Skapa ett Cloudflare-konto

1. G√• till [cloudflare.com](https://cloudflare.com)
2. Klicka p√• **"Sign Up"** och skapa ett gratis konto
3. Verifiera din e-postadress

### Steg 2: Aktivera R2 Storage

1. Logga in p√• din Cloudflare dashboard
2. I v√§nstermenyn, klicka p√• **"R2"**
3. Om R2 inte √§r aktiverat, klicka **"Enable R2"**
4. Acceptera villkoren (R2 har en gener√∂s gratis-niv√•)

### Steg 3: Skapa en Bucket

1. I R2 dashboard, klicka **"Create bucket"**
2. V√§lj ett bucket-namn (t.ex. `morgonpodd`)
   - M√•ste vara globalt unikt
   - Anv√§nd endast sm√• bokst√§ver, siffror och bindestreck
3. V√§lj en region n√§ra din m√•lgrupp (t.ex. "EEUR" f√∂r Europa)
4. Klicka **"Create bucket"**

### Steg 4: G√∂r Bucket Publik

1. Klicka p√• ditt bucket-namn
2. G√• till fliken **"Settings"**
3. Under **"Public Access"**, klicka **"Allow public access"**
4. V√§lj ett av f√∂ljande alternativ:

#### Alternativ A: Anv√§nd R2 Standard URL (Utan egen dom√§n)
Om du inte har en egen dom√§n eller vill komma ig√•ng snabbt:
1. Efter att du aktiverat public access f√•r du automatiskt en R2 dev URL
2. URL-formatet blir: `https://[bucket-namn].[konto-hash].r2.dev`
3. Exempel: `https://morgonpodd.abc123xyz.r2.dev`
4. Denna URL fungerar direkt utan ytterligare konfiguration
5. **F√∂rdelar**: Ingen DNS-konfiguration kr√§vs, fungerar omedelbart
6. **Nackdelar**: L√§ngre och mindre minnesv√§rd URL

#### Alternativ B: Anslut egen dom√§n (Rekommenderas f√∂r produktion)
Om du har en egen dom√§n:
1. Klicka **"Connect Domain"**
2. Ange en subdom√§n som `podcast.dindoman.se`
3. F√∂lj DNS-konfigurationsinstruktionerna
4. V√§nta 5-10 minuter p√• DNS-propagering
5. **F√∂rdelar**: Kort, professionell URL som √§r l√§tt att dela
6. **Nackdelar**: Kr√§ver dom√§n och DNS-konfiguration

### Steg 5: Skaffa API-uppgifter

1. G√• till **"R2"** ‚Üí **"Manage R2 API tokens"**
2. Klicka **"Create API token"**
3. Konfigurera token:
   - **Token name**: `morgonpodd-token`
   - **Permissions**: V√§lj **"Admin Read & Write"** f√∂r Object Read & Write
   - **Specify bucket**: V√§lj din bucket (`morgonpodd`)
   - **TTL**: L√§mna som standard eller s√§tt utg√•ngsdatum
4. Klicka **"Create API Token"**
5. **VIKTIGT**: Spara dessa uppgifter omedelbart (de visas bara en g√•ng):
   - **Access Key ID** ‚Üí Kopiera till `CLOUDFLARE_ACCESS_KEY_ID`
   - **Secret Access Key** ‚Üí Kopiera till `CLOUDFLARE_SECRET_ACCESS_KEY`
   - **Account ID** (visas i URL eller R2 dashboard) ‚Üí Kopiera till `CLOUDFLARE_ACCOUNT_ID`

### Steg 6: Notera din publika URL

**F√∂r Alternativ A (R2 Standard URL):**
1. G√• till din bucket i Cloudflare dashboard
2. Under fliken "Settings" hittar du din dev URL
3. Kopiera URL:en som ser ut som: `https://morgonpodd.abc123xyz.r2.dev`
4. L√§gg till denna i `.env` som `CLOUDFLARE_R2_PUBLIC_URL=https://morgonpodd.abc123xyz.r2.dev`

**F√∂r Alternativ B (Egen dom√§n):**
1. Anv√§nd din anpassade URL: `https://podcast.dindoman.se`
2. L√§gg till denna i `.env` som `CLOUDFLARE_R2_PUBLIC_URL=https://podcast.dindoman.se`

**Viktigt att komma ih√•g:**
- R2 dev URL:er √§ndras aldrig och fungerar direkt
- De √§r s√§kra att anv√§nda f√∂r produktion
- Din podcast kommer vara tillg√§nglig p√• `[din-url]/feed.xml`

## üéØ Anv√§ndning

### Generera ett enskilt avsnitt

```bash
python src/main.py
```

### K√∂r p√• schema (Dagligen kl 06:00)

```bash
python src/main.py schedule
```

### Webbgr√§nssnitt

```bash
streamlit run src/enhanced_gui.py --server.port 8504
```

√ñppna sedan http://localhost:8504 i din webbl√§sare.

### S√§tt upp automatisk daglig generering (Cron)

```bash
# Redigera crontab
crontab -e

# L√§gg till denna rad f√∂r daglig generering kl 06:00
0 6 * * * cd /s√∂kv√§g/till/morgonpodd && /s√∂kv√§g/till/venv/bin/python src/main.py
```

## üìÅ Projektstruktur

```
morgonpodd/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # Huvudorkestrator
‚îÇ   ‚îú‚îÄ‚îÄ scraper.py           # Nyhetsscraper
‚îÇ   ‚îú‚îÄ‚îÄ summarizer.py        # AI-skriptgenerator
‚îÇ   ‚îú‚îÄ‚îÄ tts_generator.py     # Text-till-tal med ElevenLabs
‚îÇ   ‚îú‚îÄ‚îÄ rss_generator.py     # RSS-feed skapare
‚îÇ   ‚îú‚îÄ‚îÄ cloudflare_uploader.py # R2 upload-hanterare
‚îÇ   ‚îú‚îÄ‚îÄ music_library.py     # Musikhantering
‚îÇ   ‚îî‚îÄ‚îÄ enhanced_gui.py      # Webbgr√§nssnitt
‚îú‚îÄ‚îÄ sources.json             # Nyhetsk√§llor konfiguration
‚îú‚îÄ‚îÄ episodes/                # Genererade ljudfiler
‚îú‚îÄ‚îÄ scripts/                 # Genererade textskript
‚îú‚îÄ‚îÄ music/                   # Musikbibliotek
‚îî‚îÄ‚îÄ public/                  # Statiska filer (RSS, bilder)
```

## ‚öôÔ∏è Konfiguration

### Nyhetsk√§llor

Du kan hantera nyhetsk√§llor p√• tv√• s√§tt:

**Via webbgr√§nssnittet (rekommenderas):**
1. Starta GUI:n: `streamlit run src/enhanced_gui.py --server.port 8504`
2. G√• till fliken "News Sources"
3. L√§gg till, redigera eller ta bort k√§llor med grafiskt gr√§nssnitt
4. Testa k√§llor direkt f√∂r att verifiera att de fungerar

**Via manuell redigering av sources.json:**
```json
{
  "sources": [
    {
      "name": "SVT Nyheter",
      "url": "https://www.svt.se/nyheter/rss.xml",
      "type": "news",
      "format": "rss",
      "maxItems": 5,
      "enabled": true
    }
  ]
}
```

### Podcast-v√§rdar

Du kan konfigurera v√§rdpersonligheter p√• tv√• s√§tt:

**Via webbgr√§nssnittet:**
1. G√• till fliken "Podcast Settings" i GUI:n
2. Redigera v√§rdpersonligheter och r√∂stinst√§llningar
3. √Ñndringarna sparas automatiskt

**Via manuell redigering av sources.json:**

```json
{
  "podcastSettings": {
    "hosts": [
      {
        "name": "Anna",
        "voice_id": "xc1ryI9pRbBLNr6aTJET",
        "personality": "Energisk och positiv morgonv√§rd",
        "style": "konversationell och varm"
      },
      {
        "name": "Erik",
        "voice_id": "iwNZQzqCFIBqLR6sgFpN",
        "personality": "Analytisk och noggrann, teknikspecialist",
        "style": "informativ men l√§ttsam"
      }
    ]
  }
}
```

## üéµ L√§gga till musik

**Via webbgr√§nssnittet (rekommenderas):**
1. G√• till fliken "Music Library" i GUI:n
2. Ladda upp MP3-filer direkt via gr√§nssnittet
3. Organisera musik i kategorier (intro, outro, transition)
4. F√∂rhandsgranska och hantera musikbiblioteket

**Manuellt:**
1. Placera MP3-filer i `music/` katalogen
2. Organisera efter kategori:
   - `music/intro/` - √ñppningsmusik
   - `music/outro/` - Avslutningsmusik
   - `music/transition/` - Mellan segment
3. Uppdatera `music_library.json` eller anv√§nd webbgr√§nssnittet

## üì± Prenumerera p√• din podcast

N√§r den √§r publicerad kommer din podcast finnas tillg√§nglig p√•:
- **RSS Feed**: `https://din-doman.com/feed.xml`
- **Webbspelare**: `https://din-doman.com/`

L√§gg till i podcast-appar:
- **Apple Podcasts**: S√∂k ‚Üí L√§gg till via URL ‚Üí Klistra in RSS URL
- **Spotify**: Skicka in via Spotify for Podcasters
- **Google Podcasts**: Inst√§llningar ‚Üí L√§gg till via RSS
- **Overcast/Pocket Casts**: L√§gg till ‚Üí L√§gg till via URL

## üîß Fels√∂kning

### Vanliga problem

**FFmpeg-fel under ljudbearbetning:**
```bash
# Se till att FFmpeg √§r installerat
brew install ffmpeg  # macOS
apt-get install ffmpeg  # Ubuntu/Debian
```

**Saknade chunks i slutgiltigt avsnitt:**
- Kontrollera `episodes/debug_chunks_*/` f√∂r alla chunk-filer
- Verifiera musikpositioner i loggar
- Se till att `maxCharsPerChunk` √§r satt till 1500 i `sources.json`

**API-hastighetsbegr√§nsningar:**
- OpenAI: Implementera f√∂rdr√∂jningar mellan f√∂rfr√•gningar
- ElevenLabs: Kontrollera din plans teckengr√§nser

**Cloudflare R2 uppladdningsfel:**
- Verifiera att bucket existerar och √§r publik
- Kontrollera att API-uppgifterna √§r korrekta
- Se till att bucket-namnet matchar i `.env`

### Debug-l√§ge

Visa detaljerade loggar:
```bash
python src/main.py 2>&1 | tee debug.log
```

## üìä √ñvervakning

- **Avsnitt**: Kontrollera `episodes/` katalogen
- **Skript**: Granska `scripts/` f√∂r genererat inneh√•ll
- **Loggar**: √ñvervaka konsoloutput eller loggfiler
- **RSS Feed**: Verifiera p√• `[publik-url]/feed.xml`

## ü§ù Bidra

1. Forka repository
2. Skapa en feature-branch
3. G√∂r dina √§ndringar
4. Testa noggrant
5. Skicka in en pull request

## üìÑ Licens

MIT License - Se LICENSE-filen f√∂r detaljer

## üôè Tack till

- **OpenAI GPT-4** - Inneh√•llsgenerering
- **ElevenLabs** - Text-till-tal
- **Cloudflare R2** - Lagring och distribution
- **Streamlit** - Webbgr√§nssnitt

## üìû Support

- GitHub Issues: [github.com/fltman/morgonradio/issues](https://github.com/fltman/morgonradio/issues)
- Dokumentation: Se `/docs` mappen

## üí° Tips

### Optimera f√∂r svenska lyssnare
- Anv√§nd svenska nyhetsk√§llor prim√§rt
- Anpassa genererings-tid till svensk morgon (06:00 CET)
- Inkludera svensk v√§derinformation

### Kostnadsoptimering
- Begr√§nsa antal nyhetsk√§llor f√∂r att minska API-kostnader
- Anv√§nd kortare sammanfattningar (justera i `sources.json`)
- √ñvervaka ElevenLabs teckenanv√§ndning

### F√∂rb√§ttra inneh√•llet
- Experimentera med olika v√§rdpersonligheter
- L√§gg till lokal musik f√∂r unik k√§nsla
- Anpassa prompt-mallar f√∂r din m√•lgrupp

---

Skapad med ‚ù§Ô∏è f√∂r automatiserad svensk podcast-produktion